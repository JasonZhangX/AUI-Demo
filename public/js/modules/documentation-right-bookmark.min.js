define(["jquery","AX","ScrollToFixed","Easing","LanguageSwitch"],function(e,n,a,t,o){"use strict";var i=n.Util.log,l={},r={bookmarkSelector:"h2",minTagNum:3,topFixHeight:120,speed:1e3,easing:"easeOutExpo",titleMarginTop:0,titleName:["在这篇文章中：","In this article:"],linkTemplate:'<li><a id="<%=id%>" href="#<%=hash%>" data-index="<%=index%>"><%=name%></a></li>',highLightClassName:"active",successStamp:"success",failedStamp:"failed",$contentContainer:e(".pure-content"),$bookmarkContainer:e(".documentation-bookmark"),endCallback:e.noop,$article:e(".pure-content .tags-date"),cloneAction:"after"},c=null,d=[],u=function(e){return Math.floor(e.offset().top)},s=function(){var e={cn:0,en:1},n=0,a=o.language();return a&&(n=e[a]),l.titleName[n]},m=function(){var n=[];return c=l.$contentContainer.children(l.bookmarkSelector),0===c.length?(l.endCallback&&l.endCallback(l.failedStamp),n):(e.each(c,function(){var a={};a.name=e(this).text(),a.top=u(e(this)),n.push(a)}),i(n),n)},h=function(){var a=d,t="",o=null,i=s();t+="<h3>"+i+"</h3>",t+="<ul>",e.each(a,function(e,a){var o="bookmark-"+e,i="bookmark-"+n.Util.replaceSpace(a.name),r=n.Util.Template(l.linkTemplate,{index:e,name:a.name,hash:o,id:i});t+=r}),t+="</ul>",l.$bookmarkContainer.empty().append(t),o=e(t).clone(!0),o=o.wrapAll("<div class='book-mark "+l.$bookmarkContainer.selector.substr(1)+" hidden-md hidden-lg'></div>").parent(),l.$article[l.cloneAction](o)},k=function(e){var n=l.$bookmarkContainer.find("li");n.removeClass(l.highLightClassName),n.eq(e).addClass(l.highLightClassName)},p=function(n){e("html,body").animate({scrollTop:n},l.speed,l.easing)},f=function(n,a){var t,o=n.scrollTop();o+n.height();return e.each(a,function(e,n){return n.top-l.titleMarginTop<=o?t=e:void 0}),t},g=function(){b(),C(),a.init({topFixedPos:0}),a.scrollToFixed(l.$bookmarkContainer,l.topFixHeight),l.endCallback&&l.endCallback(l.successStamp)},b=function(){e(document).on("click",l.$bookmarkContainer.selector,function(n){var a=e(n.target),t=a.data("index"),o=u(c.eq(t));return o-=l.titleMarginTop,p(o),!1})},C=function(){var n=e(window);n.on("scroll",function(){var e=f(n,d);void 0!==e&&k(e)})},v=function(){d=m()},x=function(n){return l=e.extend({},r,n),v(),i("oAllBookmarkData",d),d.length<l.minTagNum?void(l.endCallback&&l.endCallback(l.failedStamp)):(h(),void g())};return{init:x,update:v}});