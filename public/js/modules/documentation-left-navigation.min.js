define(["jquery","AX","IsExternalLink"],function(e,t,a){"use strict";var i=t.Util.log,n={endCallback:e.noop,$leftNavContainer:e(".documentation-navigation"),successStamp:"success",failedStamp:"failed",titleLengthLimit:10,currentClass:"active",$article:e(".pure-content"),dataHost:"./../temp/",template:{templateLevel1Title:'<a href="#" id="<%=id%>" class="menu-title" title="<%=title%>"><span class="nav-title"><%=name%></span><span class="icon icon-arrow-top"></span></a>',templateSelectOption:'<option id="<%=id%>" value="<%=url%>"><%=title%></option>',templateLevel2Title:'<li><a href="<%=url%>" id="<%=id%>" title="<%=title%>"><%=title%></a></li>'},$Select:e(".pure-content .left-navigation-select"),serviceMappingJSON:{"active-directory":"identity.json","application-gateway":"application-gateway.json","app-service-web":"web-sites.json",automation:"automation.json","azure-resource-manager":"","azure-security":"",backup:"backup.json",batch:"batch.json","best-practice":"",cache:"redis-cache.json",cdn:"cdn.json","cloud-services":"cloud-services.json","event-hubs":"event-hubs.json",expressroute:"expressroute.json",HDInsight:"hdinsight.json","iot-hub":"iot-hub.json","key-vault":"key-vault.json","media-services":"media-services.json","mobile-services	":"mobile-services.json","multi-factor-authentication	":"multi-factor-authentication.json",multiple:"",mysql:"mysql.json",na:"","notification-hubs":"notification-hubs.json",scheduler:"scheduler.json","service-bus	":"service-bus.json","site-recovery":"site-recovery.json","sql-database":"sql-databases.json","sql-data-warehouse":"sql-data-warehouse.json","sql-server-stretch-database":"sql-server-stretch-database.json",storage:"storage.json","stream-analytics":"stream-analytics.json","traffic-manager":"traffic-manager.json","virtual-machine":"virtual-machines.json","virtual-machines":"virtual-machines.json","virtual-network":"networking.json","vpn-gateway":"vpn-gateway.json","web-sites":"web-sites.json","virtual-machines-windows":"virtual-machines-windows.json","virtual-machines-linux":"virtual-machines-linux.json "}},s={},o=null,l=function(){var t=e("tags").attr("ms.service")||"";return t=t.toLowerCase()},c=function(t,a,n){var o=t();if(o){var l="";l=s.serviceMappingJSON[o]?s.dataHost+s.serviceMappingJSON[o]:s.dataHost+o+".json",e.ajax({type:"GET",url:l,dataType:"json"}).done(function(e){a(e)}).fail(function(){s.$Select.remove(),n(),i("Left navigation initialization failed","Can not load the JSON.")})}else n(),i("Left navigation initialization failed","The ms.service is undefined.")},r=function(e){return window.location.pathname===e},u=function(t){var a=window.location.pathname,i=!1;return e.each(t,function(e){return a===t[e]?(i=!0,!1):void 0}),i},d=function(e,t,a){if(-1!=e&&-1!=t){var i=o.children("li").eq(e).find("li").eq(t);i.addClass(s.currentClass)}if(""!=a){var n="option[value='"+a+"']";s.$Select.find(n).prop("selected",!0)}},v=function(){return s.$Select.find("select").on("change",function(){var t=e(this).val();a.isExternalLink(t)?window.location.href=t:window.location.href=window.location.origin+e(this).val()}),s.$Select},p=function(a){i(a);var n=a.service,l=a.navigation,c=-1,p=-1,m="",f="",h="";f+="<h3>"+n+"</h3>",f+="<ul>",e.each(l,function(a){var i=l[a].group,n=l[a].id,o=l[a].articles;f+="<li>",h+='<optgroup label="'+i+'">',f+=t.Util.Template(s.template.templateLevel1Title,{id:n,title:i,name:i}),f+='<ul class="menu-child">',e.each(o,function(e){var i=o[e].title,n=o[e].link,l=o[e].id,d=o[e].links,v={};r(n)&&(c=a,p=e,m=n),d&&u(d)&&(c=a,p=e,m=n),v={id:l,title:i,url:n},f+=t.Util.Template(s.template.templateLevel2Title,v),h+=t.Util.Template(s.template.templateSelectOption,v)}),f+="</ul>",h+="</optgroup>"}),f+="</ul>",o=e(f),s.$leftNavContainer.empty().append(o),s.$Select.find("option").remove(),s.$Select.find("select").append(h),v(),d(c,p,m);var j={};j.status=s.successStamp,j.index=c,s.endCallback&&s.endCallback(j),i("Left navigation initialization success.")},m=function(){var e={};e.status=s.failedStamp,e.index=-1,s.endCallback&&s.endCallback(e)},f=function(t){s=e.extend({},n,t),c(l,p,m)};return{init:f}});